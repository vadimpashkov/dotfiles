#!/bin/bash

# Путь к файлу истории буфера обмена
HISTORY_FILE="$HOME/.clipboard_history"

# Последнее значение буфера обмена, которое было обработано
LAST_CLIP=""

# Создаём файл истории, если он не существует
touch "$HISTORY_FILE"

# Демон, который следит за содержимым буфера обмена
while true; do
  # Получаем текущее содержимое буфера обмена и удаляем пробельные символы
  CURRENT_CLIP=$(xclip -selection clipboard -o 2>/dev/null | xargs)

  if [[ "$CURRENT_CLIP" != "" && "$CURRENT_CLIP" != "$LAST_CLIP" ]]; then
    # Получаем последнюю запись из файла истории и удаляем пробельные символы
    LAST_HISTORY_CLIP=$(tail -n1 "$HISTORY_FILE" | xargs)

    # Сравниваем текущую строку с последней записанной строкой в файле истории
    if [[ "$CURRENT_CLIP" != "$LAST_HISTORY_CLIP" ]]; then
      # Если строки не совпадают, записываем текущую строку в файл истории
      echo "$CURRENT_CLIP" >> "$HISTORY_FILE"
      # Обновляем последнюю обработанную строку
      LAST_CLIP="$CURRENT_CLIP"
    fi
  fi

  # Ждём перед следующей проверкой
  sleep 1
done
